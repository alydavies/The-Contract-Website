{% extends "site_base.html" %}

{% load i18n %}
{% load static %}
{% load account_tags %}


{% block head_title %}Viewing Scenario{% endblock %}

{% block body_class %}home{% endblock %}

{% block extra_styles %}
    <link rel="stylesheet" type="text/css" href="{% static 'games/view_scenario.css' %}" />
{% endblock %}

{% block extra_scripts %}
    <script>
        {% if show_spoiler_warning %}
            showSpoilers=true;
        {% else %}
            showSpoilers=false;
        {% endif %}
        {% if is_public %}
            scenarioIsPublic=true;
        {% else %}
            scenarioIsPublic=false;
        {% endif %}
    </script>
    <script src="{% static 'games/view_scenario_scripts.js' %}"></script>
{% endblock %}

{% block body_base %}
<div class="container">
    {% if show_spoiler_warning %}
        <div class="modal fade" id="spoilerModal" tabindex="-1" role="dialog" aria-labelledby="tutorialModalLabel" data-keyboard="false">
          <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
              <div class="modal-header text-center css-big-modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" class="text-primary">&times;</span></button>
                <h2 class="modal-title">Spoiler Warning!</h2>
              </div>
              <div class="modal-body css-big-modal-body text-center">
                  <p>
                      The page contains the complete writeup for the Scenario: "{{scenario.title}}".
                  </p>
                  <p class="lead">
                      If you view this Scenario, you will only be able to run it as GM, never play a Contractor in it.
                  </p>
              </div>
              <div class="modal-footer">
                  <div class="text-center">
                   <form class="js-accept-spoilers" data-spoiler-url="{% url 'games:games_spoil_scenario' scenario.id %}">
                   <a class="btn btn-primary" href="javascript:history.back()">Go Back</a>
                            {% csrf_token %}
                        <input type="submit" class="btn btn-default" value="Spoil Away" />
                    </form>
                  </div>
              </div>
            </div>
          </div>
        </div>
        <div class="text-center" id="spoil-confirm-buttons">
            <br>
            <h3>This writeup contains spoilers for the Scenario "{{scenario.title}}"</h3>
            <form class="js-accept-spoilers" data-spoiler-url="{% url 'games:games_spoil_scenario' scenario.id %}">
            <a class="btn btn-primary" href="javascript:history.back()">Go Back</a>
                    {% csrf_token %}
                    <input type="submit" class="btn btn-default" value="Spoil Away!"/>
            </form>
        </div>
    {% endif %}

    <span id="scenario-content"
          {% if show_spoiler_warning %}
            style="display:none;"
          {% endif %}>
        {% if not show_spoiler_warning or is_public %}
            {% include "games/view_scenario_header.html" %}
            <div class="text-center"
                 {% if scenario.is_valid %}
                    class="css-scenario-with-writeup-title"
                 {% endif %}
            >
                <h1 style="margin-bottom: 5px;">
                    {{ scenario.title }}
                </h1>
                <h4 class="text-center" style="margin-top: 5px; margin-bottom: 5px;">
                    A
                    {% if scenario_writeup.is_rivalry or scenario_writeup.is_highlander %}
                        {% if scenario_writeup.is_rivalry %}Rivalry{% endif %} {% if scenario_writeup.is_highlander %}Highlander{% endif %}
                    {% endif %}
                    Scenario written by
                    <a href="{% url 'profiles:profiles_view_profile' scenario.creator.profile.id %}">{% user_display scenario.creator %}</a>
                </h4>
                    <h5 style="margin-top: 0px;">
                        Suggested for
                        <b>{{scenario_writeup.min_players}}</b>
                        to
                        <b>{{scenario_writeup.max_players}}</b>
                        <b>{{scenario_writeup.get_suggested_status_display}}</b>
                        {% if scenario_writeup.requires_ringer %}
                             Contractors and a Ringer.
                        {% else %}
                            Contractors.
                        {% endif %}
                        <div class="text-muted">
                            {% include "games/view_scenario_writeup_stats.html" %}
                        </div>
                    </h5>
            </div>
            <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                <div class="panel panel-default">
                    <div class="panel-heading text-center">
                        {% if games_run_by_viewer or games_run_by_others %}
                            <a role="button" data-toggle="collapse" href="#collapseActivity" aria-expanded="true" aria-controls="collapseActivity">
                                <div class="" role="tab" id="summaryHeading">
                                    <h3 style="margin-top: 5px;">
                                        This Scenario has been run <b>{{ scenario.num_finished_games }}</b> time{{scenario.num_finished_games|pluralize}}
                                    </h3>
                                    <div>
                                        Run {{scenario.times_run}} times by {{scenario.num_gms_run}} GMs.
                                        {{scenario.num_victories}} victories and {{scenario.num_deaths}} deaths.
                                    </div>
                                    <div class="text-muted">
                                        (Click to expand history)
                                    </div>
                                </div>
                            </a>
                        {% else %}
                            <h3>
                                This Scenario has never been run
                            </h3>
                        {% endif %}
                    </div>
                    {% if games_run_by_viewer or games_run_by_others %}
                        <div id="collapseActivity" class="panel-collapse collapse" role="tabpanel" aria-labelledby="activityHeading">
                            <div class="panel-body">
                                {% include "games/view_scenario_history.html" %}
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading text-center">
                        <div class="panel-heading text-center" role="tab" id="writeupHeading">
                            <h2
                                    style="margin-top: 0px; margin-bottom: 0px;"
                            >
                                Writeup
                            </h2>
                            {% if scenario_writeup.summary %}
                                <h3 style="margin-top: 0px;">
                                    <small>
                                        {{ scenario_writeup.summary }}
                                    </small>
                                </h3>
                            {% endif %}
                        </div>
                </div>
                <div class="panel-body">
                    <div id="collapseWriteup" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="writeupHeading">
                        {{scenario_writeup.section_mission|safe}}
                    </div>
                </div>
            </div>
        {% endif %}
    </span>
</div>

{% endblock %}